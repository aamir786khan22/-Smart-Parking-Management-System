{% extends 'base.html' %}
{% load static %}
{% block content %}
<h2 style="display:flex;align-items:center;gap:.75rem;">
  Parking Slots
</h2>

{% if my_active %}
  <div class="notice">
    <p>Your active booking: Slot {{ my_active.slot.slot_number }} (Vehicle: {{ my_active.vehicle_no }})</p>
    <a class="btn secondary" href="{% url 'release_slot' my_active.id %}">Release Now</a>
  </div>
{% endif %}

<div class="grid">
  {% for s in slots %}
    <div class="card {{ s.status }}">
      <h3>Slot {{ s.slot_number }}</h3>
      <p>Status: <strong>{{ s.status|title }}</strong></p>

      {% if s.status == 'available' and not my_active %}
        <form method="post" action="{% url 'book_slot' s.id %}">
          {% csrf_token %}
          <button class="btn" type="submit">Book</button>
        </form>
      {% elif s.status == 'occupied' and my_active and my_active.slot.id == s.id %}
        <a class="btn secondary" href="{% url 'release_slot' my_active.id %}">Release</a>
      {% else %}
        <button class="btn disabled" type="button" disabled>Not Available</button>
      {% endif %}
    </div>
  {% endfor %}
</div>
{% endblock %}
